<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Japan's Architectural Museums & Galleries</title>
    <style>
        /* ================================
   EARLY MODERNISM THEME TOKENS
   (Bauhaus / De Stijl / Int'l Style)
   ================================ */

:root {
  /* Typography */
  --font-sans: "Futura PT","Avenir Next","Montserrat","Noto Sans JP","Helvetica Neue",Arial,sans-serif;

  /* Core Palette (Modernist primaries + neutrals) */
  --color-red: #E5252A;
  --color-blue: #0057B8;
  --color-yellow: #F6D32D;
  --color-black: #111111;
  --color-white: #FFFFFF;
  --color-concrete: #F5F5F5;
  --color-rule: #D9D9D9;
  --color-text: var(--color-black);
  --color-text-2: #333333;

  /* Roles */
  --bg-page: var(--color-white);
  --bg-surface: var(--color-concrete);
  --link: var(--color-blue);
  --link-hover: #003E86;
  --focus: var(--color-blue);

  /* Spacing / Radius / Motion */
  --s-1: 4px;
  --s-2: 8px;
  --s-3: 12px;
  --s-4: 16px;
  --s-5: 24px;
  --s-6: 32px;
  --s-7: 48px;
  --radius: 4px;
  --shadow-1: 0 1px 0 rgba(0,0,0,0.06);
  --t-fast: 120ms linear;
}

/* =========
   GLOBAL
   ========= */
* { margin: 0; padding: 0; box-sizing: border-box; }

html { font-family: var(--font-sans); }

body {
  background: var(--bg-page);
  color: var(--color-text);
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Links & Focus (utilitarian) */
a { color: var(--link); text-decoration: none; }
a:hover { color: var(--link-hover); text-decoration: underline; transition: color var(--t-fast); }
:focus-visible { outline: 2px solid var(--focus); outline-offset: 2px; }

/* Container uses modular grid gaps */
.container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 var(--s-4);
}

/* =========
   HEADER / NAV
   ========= */
header {
  background: var(--bg-page);
  padding: var(--s-4) 0;
  position: sticky;
  top: 0;
  z-index: 100;
  border-bottom: 1px solid var(--color-rule);
  /* Removed backdrop blur and heavy shadows */
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

h1 {
  color: var(--color-text);
  font-size: clamp(24px, 3vw, 40px);
  font-weight: 900;              /* geometric, assertive */
  letter-spacing: 0.2px;
  line-height: 1.12;
}

.subtitle {
  color: var(--color-text-2);
  font-size: 0.95rem;
  margin-top: var(--s-1);
}

nav {
  display: flex;
  gap: var(--s-5);
}

nav a {
  color: var(--color-text-2);
  font-weight: 600;
  padding: var(--s-2) var(--s-4);
  border-radius: var(--radius);
  border: 1px solid transparent;
  transition: border-color var(--t-fast), transform var(--t-fast), background var(--t-fast), color var(--t-fast);
  cursor: pointer;
}

nav a:hover, nav a.active {
  background: var(--color-blue);
  color: var(--color-white);
  border-color: var(--color-blue);
  transform: translateY(-1px);   /* subtle, functional */
}

/* =========
   SECTIONS
   ========= */
.section {
  display: none;
  padding: var(--s-7) 0;
  animation: fadeIn .3s linear;
}
.section.active { display: block; }

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(var(--s-3)); }
  to { opacity: 1; transform: translateY(0); }
}

/* =========
   GRID: MUSEUMS
   ========= */
.museums-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
  gap: var(--s-5);
  margin-top: var(--s-5);
}

/* =========
   CARDS (Museum)
   ========= */
.museum-card {
  background: var(--bg-surface);
  border-radius: var(--radius);
  overflow: hidden;
  border: 1px solid var(--color-rule);
  box-shadow: none;               /* remove decorative depth */
  transition: box-shadow var(--t-fast), transform var(--t-fast), border-color var(--t-fast);
  cursor: pointer;
  position: relative;
}

.museum-card:hover {
  border-color: var(--color-text);
  box-shadow: var(--shadow-1);
  transform: translateY(-1px);
}

.card-image {
  width: 100%;
  height: 250px;
  background: var(--bg-surface);  /* remove gradient fill */
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  color: #777;
  position: relative;
  overflow: hidden;
}

.card-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  filter: grayscale(100%) contrast(110%); /* Modernist B/W default */
}

.image-attribution {
  position: absolute;
  bottom: 0; left: 0; right: 0;
  background: rgba(0,0,0,0.3);  /* 30% black */
  color: white;
  padding: var(--s-1) var(--s-2);
  font-size: 11px;
  opacity: 0;
  transition: opacity var(--t-fast);
}
.museum-card:hover .image-attribution { opacity: 1; }

.card-content { padding: var(--s-6); }

.museum-name {
  font-size: 1.4rem;
  font-weight: 800;
  color: var(--color-text);
  margin-bottom: var(--s-1);
  line-height: 1.24;
  letter-spacing: 0.1px;
}

.museum-name-japanese {
  font-size: 1rem;
  color: var(--color-text-2);
  margin-bottom: var(--s-4);
}

.architect-info {
  display: flex;
  align-items: center;
  margin-bottom: var(--s-4);
  gap: var(--s-2);
}

/* Color badges -> flat blocks (no gradients, reduced rounding) */
.architect-name {
  border-radius: 2px;
  font-size: 0.85rem;
  font-weight: 700;
  border: none;
  background: none;   /* desaturated blue tint */
  color: #003366;  
}

.completion-year {
  background: var(--bg-surface);
  color: var(--color-text-2);
  padding: var(--s-1) var(--s-3);
  border-radius: var(--radius);
  font-size: 0.85rem;
  border: none;
}

.location-info {
  color: var(--color-text-2);
  font-size: 0.95rem;
  margin-bottom: var(--s-4);
}

/* Architectural style -> primary color block (no gradient) */
.architectural-style {
  padding: var(--s-2) var(--s-3) var(--s-2) 0;
  border-radius: 2px;
  font-size: 0.85rem;
  font-weight: 800;
  display: block;
  margin-bottom: var(--s-4);
  letter-spacing: 0.04em;
  text-transform: uppercase;
  border: none;
  background: var(--color-text-1);   /* soft red tint */
  color: #7a0b0b; 
}

.description {
  color: #444;
  font-size: 0.95rem;
  line-height: 1.6;
}

/* =========
   UPLOAD SECTION
   ========= */
.upload-section {
  background: var(--bg-surface);
  border-radius: var(--radius);
  padding: var(--s-7);
  border: 1px solid var(--color-rule);
  box-shadow: none;
  margin-top: var(--s-5);
}

/* Upload CSS styles
.upload-area {
  border: 2px solid var(--color-rule);
  border-radius: var(--radius);
  padding: calc(var(--s-7) + var(--s-2)) var(--s-6);
  text-align: center;
  transition: border-color var(--t-fast), background var(--t-fast);
  cursor: pointer;
}
.upload-area:hover, .upload-area.dragover {
  border-color: var(--color-blue);
  background: #fff;
}

.upload-icon {
  font-size: 2.5rem;
  color: #999;
  margin-bottom: var(--s-4);
} */
 
.upload-text {
  font-size: 1.1rem;
  color: var(--color-text-2);
  margin-bottom: var(--s-2);
}
.upload-subtext {
  color: #777;
  font-size: 0.9rem;
}

#csvInput { display: none; }

/* =========
   BUTTONS (utilitarian)
   ========= */
.btn {
  background: var(--color-blue);
  color: white;
  padding: var(--s-3) var(--s-5);
  border: 1px solid var(--color-blue);
  border-radius: var(--radius);
  font-size: 1rem;
  font-weight: 800;
  letter-spacing: 0.02em;
  cursor: pointer;
  transition: background var(--t-fast), border-color var(--t-fast), transform var(--t-fast);
  margin: var(--s-2);
}
.btn:hover {
  background: var(--link-hover);
  border-color: var(--link-hover);
  transform: translateY(-1px);
}

/* =========
   MODAL
   ========= */
/* Backdrop */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.8);
  z-index: 1000;
}

/* When open, center the panel */
.modal.open {
  align-items: flex-start;       /* or center */
  justify-content: center;
  padding: 4vh 2vw;              /* breathing room */
  pointer-events: auto;
}

/* Panel sizing */
.modal-content {
  width: clamp(320px, 92vw, 1000px);   /* cap width */
  max-height: 92vh;
  overflow: auto;
  margin: 0;                           /* don't rely on auto margins */
  border-radius: 4px;
  border: 1px solid var(--color-rule);
  background: var(--bg-page);
}

@keyframes modalFadeIn {
  from { opacity: 0; transform: translateY(-24px); }
  to   { opacity: 1; transform: translateY(0); }
}

.close {
  color: white;
  font-size: 22px;
  font-weight: 800;
  position: absolute;
  right: 20px;
  top: 15px;
  z-index: 1001;
  cursor: pointer;
  background: rgba(0,0,0,0.6);
  width: 36px; height: 36px;
  border-radius: 50%;
  display: grid; place-items: center;
  transition: background var(--t-fast);
}
.close:hover { background: rgba(0,0,0,0.86); }

.modal-header {
  position: relative;
  height: 400px;
  background: var(--bg-surface);
  display: flex; align-items: center; justify-content: center;
  overflow: hidden;
  border-bottom: 1px solid var(--color-rule);
}
.modal-header img {
  width: 100%; height: 100%; object-fit: cover;
  filter: grayscale(100%) contrast(110%);
}

.modal-title {
  position: absolute;
  bottom: 0; left: 0; right: 0;
  background: linear-gradient(transparent, rgba(0,0,0,0.82));
  color: white;
  padding: var(--s-6) var(--s-5) var(--s-5);
}

.modal-museum-name {
  font-size: clamp(26px, 3.2vw, 40px);
  font-weight: 900;
  margin-bottom: var(--s-1);
  line-height: 1.18;
}
.modal-museum-japanese {
  font-size: 1.1rem;
  opacity: 0.9;
  margin-bottom: var(--s-3);
}
.modal-architect {
  font-size: 1rem;
  font-weight: 700;
}

.modal-body { padding: var(--s-6); }
/* =========
   INFO GRID / CARDS
   ========= */
.info-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--s-5);
  margin-bottom: var(--s-6);
}

.info-card {
  background: var(--bg-surface);
  padding: var(--s-5);
  border-radius: var(--radius);
  border: 1px solid var(--color-rule);
  /* Removed colored left rule; modernist uses keylines sparingly */
}

.info-label {
  font-weight: 800;
  color: var(--color-text);
  margin-bottom: var(--s-2);
  font-size: 0.85rem;
  text-transform: uppercase;
  letter-spacing: 0.12em;
}
.info-value {
  color: #444;
  font-size: 1rem;
  line-height: 1.5;
}

/* =========
   NEARBY ATTRACTIONS
   ========= */
.attraction-section { margin-top: var(--s-6); }

.attraction-title {
  font-size: 1.4rem;
  font-weight: 900;
  color: var(--color-text);
  margin-bottom: var(--s-4);
  padding-bottom: var(--s-2);
  border-bottom: 1px solid var(--color-rule);
}

.attractions-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--s-5);
}

.attraction-card {
  background: var(--bg-page);
  border: 1px solid var(--color-rule);
  border-radius: var(--radius);
  overflow: hidden;
  transition: box-shadow var(--t-fast), transform var(--t-fast), border-color var(--t-fast);
}
.attraction-card:hover {
  box-shadow: var(--shadow-1);
  transform: translateY(-1px);
  border-color: var(--color-text);
}

.attraction-image {
  width: 100%;
  height: 200px;
  background: var(--bg-surface);
  display: flex; align-items: center; justify-content: center;
  font-size: 14px; color: #777;
  position: relative; overflow: hidden;
}
.attraction-image img {
  width: 100%; height: 100%; object-fit: cover;
  filter: grayscale(100%) contrast(110%);
}

.attraction-content { padding: var(--s-5); }

.attraction-name {
  font-size: 1.15rem;
  font-weight: 800;
  color: var(--color-text);
  margin-bottom: var(--s-2);
}
.attraction-japanese {
  color: var(--color-text-2);
  font-size: 0.95rem;
  margin-bottom: var(--s-4);
}
.attraction-description {
  color: #444;
  font-size: 0.95rem;
  line-height: 1.5;
  font-style: normal; /* remove italics for rational tone */
}

/* =========
   STATUS / NOTICES
   ========= */
.status-message {
  background: var(--color-yellow);
  border: 1px solid var(--color-black);
  padding: var(--s-3) var(--s-4);
  margin: var(--s-4) 0;
  border-radius: var(--radius);
  color: var(--color-black);
  font-weight: 800;
}

/* =========
   RESPONSIVE
   ========= */
@media (max-width: 1024px) {
  .museums-grid { grid-template-columns: 1fr 1fr; }
}
@media (max-width: 768px) {
  .museums-grid { grid-template-columns: 1fr; gap: var(--s-4); }

  .info-grid, .attractions-grid {
    grid-template-columns: 1fr;
    gap: var(--s-4);
  }

  .modal-content {
    width: 95%;
    margin: 5% auto;
  }
  .modal-museum-name { font-size: clamp(22px, 5vw, 32px); }

  .modal-body { padding: var(--s-4); }

  nav { gap: var(--s-3); }
  nav a { padding: var(--s-2) var(--s-3); font-size: 0.95rem; }
}

/* =========
   UTILITIES (optional)
   ========= */
.rule { height: 1px; background: var(--color-rule); }
.pad-hero { padding-block: clamp(48px, 8vw, 112px); }

/* Restore full-color photos sitewide */
.card-image img,
.attraction-image img,
.modal-header img {
  filter: none !important;
}

/* --- Modal hard layout override --- */
/* Backdrop (hidden by default) */
#museumModal {
  display: none;                /* key: hidden by default */
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.8);
  z-index: 1000;
  overflow-x: hidden;
}

/* Visible state */
#museumModal.open {
  display: flex;                /* show & center only when .open is present */
  align-items: flex-start;      /* or center */
  justify-content: center;
  padding: 4vh 2vw;
}

/* Panel sizing */
#museumModal .modal-content {
  width: clamp(320px, 92vw, 1000px);
  max-height: 92vh;
  overflow: auto;
  margin: 0;
  border: 1px solid var(--color-rule);
  border-radius: 4px;
  background: var(--bg-page);
  box-sizing: border-box;
}

/* Neutralize any sitewide .container inside the modal */
#museumModal .container {
  max-width: none;
  width: auto;
  padding: 0;
}

/* Defensive: children can't force overflow width */
#museumModal img { max-width: 100%; height: auto; display: block; }
#museumModal * { box-sizing: border-box; }
#museumModal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.8); z-index: 1000; }
#museumModal.open { display: flex; align-items: flex-start; justify-content: center; padding: 4vh 2vw; }
#museumModal .modal-content { width: clamp(320px, 92vw, 1000px); max-height: 92vh; overflow: auto; }

    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div>
                    <h1>Japan's Architectural Museums</h1>
                    <div class="subtitle">Discover architectural masterpieces in Tokyo and across Japan's regions</div>
                </div>
                <nav>
                    <a onclick="showSection('museums')" class="active">Museums</a>
                    <!--<a onclick="showSection('upload')">Upload CSV</a>-->
                    <a href="about.html">About</a>
                    <a href="contact.html">Contact</a>
                    <a href="privacy-policy.html">Privacy</a>
                </nav>
            </div>
        </div>
    </header>

    <div class="container">
        <div id="museums" class="section active">
            <!-- <div class="status-message" id="status-message"> 
                Upload your CSV file to load museum data and photos
            </div> -->
            <div class="museums-grid" id="museums-grid">
                <!-- Museum cards will be populated here -->
            </div>
        </div>

        <!-- <div id="upload" class="section">
            <div class="upload-section">
                <h2 style="margin-bottom: 30px; color: #333;">Upload Museum Data</h2>
                <div class="upload-area" onclick="document.getElementById('csvInput').click()">
                    <div class="upload-icon">📁</div>
                    <div class="upload-text">Click to upload CSV file</div>
                    <div class="upload-subtext">or drag and drop your file here</div>
                </div>
                <input type="file" id="csvInput" accept=".csv">
                <button class="btn" onclick="document.getElementById('csvInput').click()">Choose File</button>
            </div>
        </div> -->

        <div id="about" class="section">
            <div class="upload-section">
                <h2 style="margin-bottom: 30px; color: #333;">About This Project</h2>
                <p style="font-size: 1.1rem; line-height: 1.8; color: #555; margin-bottom: 20px;">
                    This project showcases architecturally significant museums and galleries across Japan's regions, 
                    featuring works by renowned architects including Tadao Ando, SANAA, Kengo Kuma, and others.
                </p>
                <p style="font-size: 1rem; line-height: 1.6; color: #666;">
                    Each museum represents post-war architectural innovation or early 20th century modern/deco styles 
                    that survived intact, providing foreign visitors with a comprehensive guide to Japan's architectural heritage.
                </p>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="museumModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        
        <div class="modal-header" id="modal-header">
            <img alt="">
            <div class="modal-title">
                <div class="modal-museum-name"></div>
                <div class="modal-museum-japanese"></div>
                <div class="modal-architect"></div>
            </div>
        </div>
            <div class="modal-body">
                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-label">Architectural Details</div>
                        <div class="info-value">
                            <strong>Style:</strong> <span id="modal-style"></span><br>
                            <strong>Completed:</strong> <span id="modal-year"></span><br>
                            <strong>Architect (JP):</strong> <span id="modal-architect-jp"></span>
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Location & Access</div>
                        <div class="info-value">
                            <strong>City:</strong> <span id="modal-city"></span><br>
                            <strong>Prefecture:</strong> <span id="modal-prefecture"></span><br>
                            <strong>Nearest Station:</strong> <span id="modal-station"></span><br>
                            <strong>Major City:</strong> <span id="modal-major-city"></span>
                        </div>
                    </div>
                </div>
                
                <div class="info-card">
                    <div class="info-label">Museum Description</div>
                    <div class="info-value" id="modal-description"></div>
                </div>
                
                <div class="info-card" style="margin-top: 20px;">
                    <div class="info-label">Architectural Highlights</div>
                    <div class="info-value" id="modal-highlights"></div>
                </div>
                
                <div class="info-card" style="margin-top: 20px;">
                    <div class="info-label">Accessibility Notes</div>
                    <div class="info-value" id="modal-accessibility"></div>
                </div>

                <div class="attraction-section">
                    <div class="attraction-title">Featured Attractions</div>
                    <div class="attractions-grid">
                        <div class="attraction-card">
    <div class="attraction-image" id="attraction-1-image">
        <span>Attraction Photo Placeholder</span>
    </div>
    <div class="attraction-content">
        <div class="attraction-name" id="attraction-1-name">Primary Museum Experience</div>
        <div class="attraction-japanese" id="attraction-1-japanese">主要な美術館体験</div>
        <div class="attraction-description" id="attraction-1-description">
            Explore the main museum collections and architectural features. Experience the harmonious blend of space, light, and artistic expression.
        </div>
    </div>
</div>

<div class="attraction-card">
    <div class="attraction-image" id="attraction-2-image">
        <span>Secondary Attraction Placeholder</span>
    </div>
    <div class="attraction-content">
    <div class="attraction-name" id="attraction-2-name">Nearby Cultural Site</div>
    <div class="attraction-japanese" id="attraction-2-japanese">近くの文化施設</div>
    <div id="attraction-2-distance" style="font-size: 0.85em; color: #666; font-style: italic; margin-top: 0.25rem; margin-bottom: 0.5rem;">
        <span style="margin-right: 0.3rem;">📍</span>
        <span id="attraction-2-distance-text">5-min walk</span>
    </div>
    <div class="attraction-description" id="attraction-2-description">
        Discover complementary cultural attractions in the surrounding area. Perfect for extending your architectural pilgrimage.
    </div>
</div>
    </div>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <div class="container">
            <div class="footer-links">
                <a href="index.html">Museums</a>
                <a href="about.html">About</a>
                <a href="contact.html">Contact</a>
                <a href="privacy-policy.html">Privacy Policy</a>
                <a href="terms.html">Terms of Service</a>
            </div>
            <p>&copy; 2025 Architectural Museums of Japan. All rights reserved.</p>
        </div>
    </footer>
    <script>
        let museumsData = [];

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            document.querySelectorAll('nav a').forEach(link => link.classList.remove('active'));
            
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // Find and activate the correct nav link
            const navLinks = document.querySelectorAll('nav a');
            navLinks.forEach(link => {
                if (link.getAttribute('onclick') && link.getAttribute('onclick').includes(sectionId)) {
                    link.classList.add('active');
                }
            });
        }

        // CSV Upload and Processing
        // const csvInput = document.getElementById('csvInput');
        if (csvInput) {
            csvInput.addEventListener('change', handleFileUpload);
        }

        // Drag and drop
        const uploadArea = document.querySelector('.upload-area');
        if (uploadArea) {
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
    if (file.type !== 'text/csv' && !file.name.endsWith('.csv')) {
        alert('Please upload a CSV file');
        return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
        // Read as ArrayBuffer then decode as UTF-8
        const arrayBuffer = e.target.result;
        const decoder = new TextDecoder('utf-8');
        let csvData = decoder.decode(arrayBuffer);
        
        // Remove BOM if present
        if (csvData.charCodeAt(0) === 0xFEFF) {
            csvData = csvData.substr(1);
        }
        
        parseCSV(csvData);
    };
    
    // Read as binary array buffer instead of text
    reader.readAsArrayBuffer(file);
}
        function parseCSV(csvData) {
            const lines = csvData.split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            
            museumsData = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = parseCSVLine(lines[i]);
                    if (values.length === headers.length) {
                        const museum = {};
                        headers.forEach((header, index) => {
                            museum[header] = values[index] ? values[index].trim() : '';
                        });
                        museumsData.push(museum);
                    }
                }
            }
            
            console.log('Parsed museums data:', museumsData); // Debug log
            displayMuseums();
            document.getElementById('status-message').innerHTML = `✅ Loaded ${museumsData.length} museums successfully`;
            showSection('museums');
        }

        function parseCSVLine(line) {
            const values = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    values.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            values.push(current);
            return values;
        }

        function displayMuseums() {
            const grid = document.getElementById('museums-grid');
            grid.innerHTML = '';
            
            museumsData.forEach((museum, index) => {
                const card = createMuseumCard(museum, index);
                grid.appendChild(card);
            });
        } 

        function createMuseumCard(museum, index) {
  const card = document.createElement('div');
  card.className = 'museum-card';
  card.onclick = () => openModal(museum);

  const placeholder = `
    <div style="display:flex; width:100%; height:100%; background: linear-gradient(45deg, #f0f0f0, #e0e0e0); align-items:center; justify-content:center; font-size:14px; color:#999;">
      Museum Photo Placeholder
    </div>
  `;

  card.innerHTML = `
    <div class="card-image">
      ${
        museum.museum_image_url
          ? `
              <img src="${museum.museum_image_url}" alt="${museum.museum_name}"
                   onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
              ${placeholder}
            `
          : placeholder
      }
      ${
        museum.image_attribution
          ? `<div class="image-attribution">${museum.image_attribution}</div>`
          : ''
      }
    </div>
  `;

  return card;
}


       
// Modal functionality
const modal    = document.getElementById('museumModal'); // keep
const closeBtn = document.querySelector('.close');       // keep

function openModal(museum) {
  if (!modal) { console.error('Modal root #museumModal not found'); return; }

  // Scope lookups to the modal
  const qs = (sel) => modal.querySelector(sel);
  const setText = (sel, value) => {
    const el = qs(sel);
    if (!el) { console.warn('Missing node for selector:', sel); return; }
    el.textContent = value ?? '';
  };

  // Header text (class-based, matches your injected HTML)
  setText('.modal-museum-name',     museum.museum_name || museum.name || 'Museum Name');
  setText('.modal-museum-japanese', museum.museum_japanese || museum.name_japanese || 'ミュージアム名');
  setText('.modal-architect',       `Designed by ${museum.architect || 'Architect'} (${museum.completion_year || 'Year'})`);

  // Header image/title block (#modal-header exists in your HTML)
  const modalHeader = document.getElementById('modal-header');
  if (modalHeader) {
    if (museum.museum_image_url) {
      modalHeader.innerHTML = `
        <img src="${museum.museum_image_url}" alt="${museum.museum_name || museum.name || 'Museum'}" onerror="this.style.display='none';">
        <div class="modal-title">
          <div class="modal-museum-name">${museum.museum_name || museum.name || 'Museum Name'}</div>
          <div class="modal-museum-japanese">${museum.museum_japanese || museum.name_japanese || 'ミュージアム名'}</div>
          <div class="modal-architect">Designed by ${museum.architect || 'Architect'} (${museum.completion_year || 'Year'})</div>
        </div>
        ${museum.image_attribution ? `<div class="image-attribution" style="opacity:1;">${museum.image_attribution}</div>` : ''}
      `;
    } else {
      // optional: keep existing header if no image url provided
      // modalHeader.innerHTML = '';
    }
  }

  // Info cards (these IDs must exist in your modal)
  document.getElementById('modal-style')?.replaceChildren(document.createTextNode(museum.architectural_style || 'Architectural Style'));
  document.getElementById('modal-year')?.replaceChildren(document.createTextNode(museum.completion_year || 'Year'));
  document.getElementById('modal-architect-jp')?.replaceChildren(document.createTextNode(museum.architect_japanese || '建築家名'));
  document.getElementById('modal-city')?.replaceChildren(document.createTextNode(museum.city || 'City'));
  document.getElementById('modal-prefecture')?.replaceChildren(document.createTextNode(museum.prefecture || 'Prefecture'));
  document.getElementById('modal-station')?.replaceChildren(document.createTextNode(museum.nearest_station || 'Station'));
  document.getElementById('modal-major-city')?.replaceChildren(document.createTextNode(museum.nearest_major_city || 'Major City'));
  document.getElementById('modal-description')?.replaceChildren(document.createTextNode(museum.description || 'Museum description will be populated from CSV data.'));
  document.getElementById('modal-highlights')?.replaceChildren(document.createTextNode(museum.architectural_highlights || 'Architectural highlights will be populated from CSV data.'));
  document.getElementById('modal-accessibility')?.replaceChildren(document.createTextNode(museum.accessibility_notes || 'Accessibility information will be populated from CSV data.'));

  // Attractions (optional placeholders)
  const attraction1Image = document.getElementById('attraction-1-image');
  if (attraction1Image && museum.attraction_1_image_url) {
    attraction1Image.innerHTML = `
      <img src="${museum.attraction_1_image_url}" alt="Primary Attraction" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
      <div style="display:none; width:100%; height:100%; background: linear-gradient(45deg, #f0f0f0, #e0e0e0); align-items:center; justify-content:center; font-size:14px; color:#999;">
        Attraction Photo Placeholder
      </div>
      ${museum.attraction_1_attribution ? `<div class="image-attribution" style="opacity:1;">${museum.attraction_1_attribution}</div>` : ''}
    `;
  }
  const attraction2Image = document.getElementById('attraction-2-image');
  if (attraction2Image && museum.attraction_2_image_url) {
    attraction2Image.innerHTML = `
      <img src="${museum.attraction_2_image_url}" alt="Secondary Attraction" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
      <div style="display:none; width:100%; height:100%; background: linear-gradient(45deg, #f0f0f0, #e0e0e0); align-items:center; justify-content:center; font-size:14px; color:#999;">
        Attraction Photo Placeholder
      </div>
      ${museum.attraction_2_attribution ? `<div class="image-attribution" style="opacity:1;">${museum.attraction_2_attribution}</div>` : ''}
    `;
  }

  // UPDATE PRIMARY MUSEUM EXPERIENCE (ATTRACTION 1)
  const primaryName = document.getElementById('attraction-1-name');
  if (primaryName) {
    primaryName.textContent = museum.museum_name || 'Primary Museum Experience';
  }
  
  const primaryDesc = document.getElementById('attraction-1-description');
  if (primaryDesc) {
    primaryDesc.textContent = museum.primary_museum_experience_blurb || 'Explore the main museum collections and architectural features. Experience the harmonious blend of space, light, and artistic expression.';
  }
  
  // UPDATE NEARBY CULTURAL SITE (ATTRACTION 2) - if you're using it
  const culturalName = document.getElementById('attraction-2-name');
  if (culturalName) {
    culturalName.textContent = museum.nearby_cultural_attraction_name || 'Nearby Cultural Site';
  }
    // Add distance information
  const distanceText = document.getElementById('attraction-2-distance-text');
  const distanceContainer = document.getElementById('attraction-2-distance');
  if (distanceText && museum.distance_from_main_attraction) {
    distanceText.textContent = museum.distance_from_main_attraction;
    if (distanceContainer) {
      distanceContainer.style.display = 'block';
    }
  } else if (distanceContainer) {
    distanceContainer.style.display = 'none';
  }
  const culturalDesc = document.getElementById('attraction-2-description');
  if (culturalDesc) {
    culturalDesc.textContent = museum.nearby_cultural_attraction_blurb || 'Discover complementary cultural attractions in the surrounding area.';
  }

  
  
  // SHOW modal (one method only)
  modal.classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closeModal() {
  modal.classList.remove('open');
  document.body.style.overflow = 'auto';
}

// Event listeners
if (closeBtn) closeBtn.onclick = closeModal;

// Backdrop close (don’t override other global handlers)
modal?.addEventListener('click', (e) => {
  if (e.target === modal) closeModal();
});

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  showSection('museums');
});

document.addEventListener('DOMContentLoaded', () => {
  modal?.classList.remove('open');
  document.body.style.overflow = 'auto';
});

</script>
</body>
</html>
